<script type='text/javascript' src='js/infogrid.js'></script> 		<script type='text/javascript' src='js/manageRental.js'></script><link type="text/css" href="css/infogrid.css" rel="stylesheet"><?phprequire 'required.php';	if($_SESSION['user']->getIsAdmin() == 1) { 		if(!isset($rentalManager)) $rentalManager = ManagerFactory::getRentalManager();			if(isset($_POST['displayRentals'])) {						if($_POST['displayRentals'] == "all") {								$rentalList = $rentalManager->findAllRentals();							}else if($_POST['displayRentals'] == "Mine") {						$rentalList = $rentalManager->findRentalsByPilot($_SESSION['user']->getFirstName().' '.$_SESSION['user']->getLastName());						}else if($_POST['displayRentals'] == "Today") {				$rentalList = $rentalManager->findRentalsByDate(date('Y-m-d'));						}else if($_POST['displayRentals'] == "cWeek") {								$today = date('w'); // 0 for sunday, 6 for saturday								if($today == '0') {										for($i = -6; $i < 3; $i++) {												$rentalList[$i] = $rentalManager->findRentalsByDate(date('Y-m-d', strtotime('+'.$i.' day')));										}								}else if($today == '1') {									for($i = 0; $i < 7; $i++) {												$rentalList[$i] = $rentalManager->findRentalsByDate(date('Y-m-d', strtotime('+'.$i.' day')));										}			}else if($today == '2') {										for($i = -1; $i < 6; $i++) {											$rentalList[$i] = $rentalManager->findRentalsByDate(date('Y-m-d', strtotime('+'.$i.' day')));											}			}else if($today == '3') {										for($i = -2; $i < 5; $i++) {											$rentalList[$i] = $rentalManager->findRentalsByDate(date('Y-m-d', strtotime('+'.$i.' day')));											}			}else if($today == '4') {										for($i = -3; $i < 4; $i++) {											$rentalList[$i] = $rentalManager->findRentalsByDate(date('Y-m-d', strtotime('+'.$i.' day')));											}			}else if($today == '5') {									for($i = -4; $i < 3; $i++) {												$rentalList[$i] = $rentalManager->findRentalsByDate(date('Y-m-d', strtotime('+'.$i.' day')));										}			}else if($today == '6') {										for($i = -5; $i < 2; $i++) {											$rentalList[$i] = $rentalManager->findRentalsByDate(date('Y-m-d', strtotime('+'.$i.' day')));										}			}		}					}else if(isset($_POST['displayStatus'])) {					if($_POST['displayStatus'] == "done" || $_POST['displayStatus'] == "pending" || $_POST['displayStatus'] == "accepted") {							$rentalList = $rentalManager->findRentalsByStatus($_POST['displayStatus']);							}				}else if(isset($_POST['displayPlane'])) {					$rentalList = $rentalManager->findRentalsByPlane($_POST['displayPlane']);					}else if(isset($_POST['displayDate'])) {						$rentalList = $rentalManager->findRentalsByDate($_POST['displayDate']);			}else if(isset($_POST['displayPilot'])) {				$rentalList = $rentalManager->findRentalsByPilot($_POST['displayPilot']);				}		if(isset($_POST['displayRentals']) || isset($_POST['displayStatus']) || isset($_POST['displayPlane']) || isset($_POST['displayDate']) || isset($_POST['displayPilot'])) {					if(isset($rentalList)) {						$count = 0;			foreach($rentalList as $rental) {				$count = $count + 1; 								}								if($count != 0) { ?>									<table>					<tr>						<th>ID of Reservation</th>						<th>ID of Plane</th>						<th>Date of flight</th>						<th>FI Number</th>						<th>Begin</th>						<th>End</th>						<th>Flight Lenght</th>						<th>Status</th>					</tr><?php 				if(isset($_POST['displayRentals']) && $_POST['displayRentals'] == "cWeek") {																if(!isset($journeyLogManager)) $journeyLogManager = ManagerFactory::getJourneyLogManager();					foreach($rentalList as $rentalL) {																		foreach($rentalL as $rental) { 																					$journeyLogList = $journeyLogManager->findJourneyLogByRentalId($rental->getIdReservation());														?>													<tr>								<td><?php echo $rental->getIdReservation(); ?></td>								<td><a onclick="displayByPlane('<?php echo $rental->getIdPlane(); ?>')"><?php echo $rental->getIdPlane(); ?></a></td>								<td><a onclick="displayByDate('<?php echo $rental->getDateReservation(); ?>')"><?php echo $rental->getDateReservation(); ?></a></td>								<td><a onclick="displayByPilot('<?php echo $rental->getFInumber(); ?>')"><?php echo $rental->getFInumber(); ?></a></td><?php  						foreach($journeyLogList as $journeyLog) { ?>								<td><?php echo $journeyLog->getDepartureTime(); ?></td>								<td><?php echo $journeyLog->getArrivalTime(); ?></td><?php  						}   ?>								<td><?php echo $rental->getDureeReservation(); ?></td>								<td><a onclick="displayByStatus('<?php echo $rental->getStatus(); ?>')"><?php echo $rental->getStatus(); ?></a></td>							</tr>												<?php					}					}																}else {																if(!isset($journeyLogManager)) $journeyLogManager = ManagerFactory::getJourneyLogManager();						foreach($rentalList as $rental) { 																			$journeyLogList = $journeyLogManager->findJourneyLogByRentalId($rental->getIdReservation()); ?>																		<tr>								<td><?php echo $rental->getIdReservation(); ?></td>								<td><a onclick="displayByPlane('<?php echo $rental->getIdPlane(); ?>')"><?php echo $rental->getIdPlane(); ?></a></td>								<td><a onclick="displayByDate('<?php echo $rental->getDateReservation(); ?>')"><?php echo $rental->getDateReservation(); ?></a></td>								<td><a onclick="displayByPilot('<?php echo $rental->getFInumber(); ?>')"><?php echo $rental->getFInumber(); ?></a></td>					<?php  	foreach($journeyLogList as $journeyLog) { ?>								<td><?php echo $journeyLog->getDepartureTime(); ?></td>								<td><?php echo $journeyLog->getArrivalTime(); ?></td>					<?php  }   ?>								<td><?php echo $rental->getDureeReservation(); ?></td>								<td><a onclick="displayByStatus('<?php echo $rental->getStatus(); ?>')"><?php echo $rental->getStatus(); ?></a></td>							</tr>			<?php 		} 					  } ?>				</table>		  <?php		}else echo "<br/><strong>No results<strong>";		}	}}if(isset($_SESSION['user'])) {		if(!isset($rentalManager)) $rentalManager = ManagerFactory::getRentalManager();		if(isset($_POST['dispMyUndone'])) {				$rentalList3 = $rentalManager->findMyUndoneFlights($_SESSION['user']->getIdMember());	}else if(isset($_POST['dispMyUndoneByPlane'])) {			$rentalList3 = $rentalManager->findMyUndoneByPlane($_POST['dispMyUndoneByPlane']);	}else if(isset($_POST['dispMyUndoneByDate'])) {			$rentalList3 = $rentalManager->findMyUndoneByDate($_POST['dispMyUndoneByDate']);	}else if(isset($_POST['dispMyUndoneByPilot'])) {			$rentalList3 = $rentalManager->findMyUndoneByPilot($_POST['dispMyUndoneByPilot']);	}else if(isset($_POST['dispMyUndoneByStatus'])) {			$rentalList3 = $rentalManager->findMyUndoneByStatus($_POST['dispMyUndoneByStatus']);	}			if(isset($rentalList3)) {									$count = 0;			foreach($rentalList3 as $rental3) {				$count = $count + 1;			}									if($count != 0) {	?>				<table>					<tr>						<th>ID of Plane</th>						<th>Date of flight</th>						<th>FI Number</th>						<th>Begin</th>						<th>End</th>						<th>Flight Lenght</th>						<th>Status</th>						<th>New status</th>					</tr>	<?php						if(!isset($journeyLogManager)) $journeyLogManager = ManagerFactory::getJourneyLogManager();				foreach($rentalList3 as $rental3) { 													$journeyLogList = $journeyLogManager->findJourneyLogByRentalId($rental3->getIdReservation()); ?>														<tr>						<td><a onclick="dispMyUndoneByPlane('<?php echo $rental3->getIdPlane(); ?>')"><?php echo $rental3->getIdPlane(); ?></a></td>						<td><a onclick="dispMyUndoneByDate('<?php echo $rental3->getDateReservation(); ?>')"><?php echo $rental3->getDateReservation(); ?></a></td>						<td><a onclick="dispMyUndoneByPilot('<?php echo $rental3->getFInumber(); ?>')"><?php echo $rental3->getFInumber(); ?></a></td>			<?php  	foreach($journeyLogList as $journeyLog) { ?>						<td><?php echo $journeyLog->getDepartureTime(); ?></td>						<td><?php echo $journeyLog->getArrivalTime(); ?></td>			<?php   }   ?>						<td><?php echo $rental3->getDureeReservation(); ?></td>						<td><a onclick="dispMyUndoneByStatus('<?php echo $rental3->getStatus(); ?>')"><?php echo $rental3->getStatus(); ?></a></td>											<?php							if($_SESSION['user']->getTypeMember() == "member") { 															if($rental3->getStatus() == "accepted") { ?>																	<td><input type="button" name="m_changeStatus" value="Done" onclick="updateStatus(<?php echo $rental3->getIdReservation() ?>,'done')"/></td>												<?php		}else echo "<td>Modification denied</td>";							}else {																if($rental3->getStatus() == "pending") { ?>																	<td><input type="button" name="pp_changeStatus" value="Accept" onclick="updateStatus('<?php echo $rental3->getIdReservation(); ?>','accepted'); return false"/></td>													<?php		}else if($rental3->getStatus() == "accepted") { ?>																	<td><input type="button" name="pa_changeStatus" value="Done" onclick="updateStatus('<?php echo $rental3->getIdReservation(); ?>','done')"/></td>													<?php		}else echo "<td>Modification denied</td>";															}						?>										</tr>								<?php		}	?>           </table>	<?php	}else echo "<br/><strong>No results<strong>";		}				if(isset($_POST['dispMyPast'])) {				$rentalList2 = $rentalManager->findMyPastFlights($_SESSION['user']->getIdMember());	}else if(isset($_POST['dispMyDoneByPlane'])) {					$rentalList2 = $rentalManager->findMyDoneByPlane($_POST['dispMyDoneByPlane']);	}else if(isset($_POST['dispMyDoneByDate'])) {			$rentalList2 = $rentalManager->findMyDoneByDate($_POST['dispMyDoneByDate']);	}else if(isset($_POST['dispMyDoneByPilot'])) {			$rentalList2 = $rentalManager->findMyDoneByPilot($_POST['dispMyDoneByPilot']);	}		if(isset($rentalList2)) { 			$count = 0;			foreach($rentalList2 as $rental2) {				$count = $count + 1;			}								if($count != 0) { ?>				<table>					<tr>						<th>ID of Plane</th>						<th>Date of flight</th>						<th>FI Number</th>						<th>Begin</th>						<th>End</th>						<th>Flight Lenght</th>						<th>Status</th>					</tr><?php						if(!isset($journeyLogManager)) $journeyLogManager = ManagerFactory::getJourneyLogManager();						foreach($rentalList2 as $rental2) { 															$journeyLogList = $journeyLogManager->findJourneyLogByRentalId($rental2->getIdReservation());?>						<tr>							<td><a onclick="dispMyDoneByPlane('<?php echo $rental2->getIdPlane(); ?>')"><?php echo $rental2->getIdPlane(); ?></a></td>							<td><a onclick="dispMyDoneByDate('<?php echo $rental2->getDateReservation(); ?>')"><?php echo $rental2->getDateReservation(); ?></a></td>							<td><a onclick="dispMyDoneByPilot('<?php echo $rental2->getFInumber(); ?>')"><?php echo $rental2->getFInumber(); ?></a></td>				<?php  	foreach($journeyLogList as $journeyLog) { ?>							<td><?php echo $journeyLog->getDepartureTime(); ?></td>							<td><?php echo $journeyLog->getArrivalTime(); ?></td>				<?php   }   ?>							<td><?php echo $rental2->getDureeReservation(); ?></td>							<td><a onclick="dispMyPast();"><?php echo $rental2->getStatus(); ?></a></td>						</tr>									<?php		}?> 				</table>													<?php		}else echo "<br/><strong>No results<strong>";			 		}	}if(isset($_POST['rent_idPlane'])) {		if(!isset($rentalManager)) $rentalManager = ManagerFactory::getRentalManager();	$res = $rentalManager->checkIfIHaveEnoughMoney($_POST['dTime'], $_POST['aTime'], $_POST['rent_idPlane']);		if(isset($_POST['date']) && isset($_POST['dTime']) && isset($_POST['aTime']) && isset($_POST['dAir']) && isset($_POST['aAir']) && isset($_POST['pilot'])) {				if(!isset($rentalManager)) $rentalManager = ManagerFactory::getRentalManager();				$today = strtotime(date('Y-m-d'));		$diff = strtotime($_POST['date']) - $today;				$duree =  strtotime($_POST['aTime']) - strtotime($_POST['dTime']);				if($diff >= 0) {			if($duree > 0) {				if($_SESSION['user']->getFeesPaid() == 1) {					if($_SESSION['user']->getTypeMember() == 'pilot') {											if($_SESSION['user']->getLicense() == 1) {													$accBalance = $rentalManager->checkIfIHaveEnoughMoney($_POST['dTime'], $_POST['aTime'], $_POST['rent_idPlane']);														if($accBalance >= 0) {														$result =  $rentalManager->addRental($_POST['rent_idPlane'], $_POST['date'], $_POST['dTime'], $_POST['aTime'], $_POST['dAir'], $_POST['aAir'], $_POST['pilot']);								echo $result;															}else echo "<style type='text/css'> #addResp { color: red; }</style>Your don't have enough money on your account. Please do a check and send it to us at : <br/>The Golden Wings <br/> 15 Baker Street <br/> 15PR Pensylvania";													}else echo "<style type='text/css'> #addResp { color: red; }</style>Your license is not valid. Please contact an administrator.";					}else {											$accBalance = $rentalManager->checkIfIHaveEnoughMoney($_POST['dTime'], $_POST['aTime'], $_POST['rent_idPlane']);													if($accBalance >= 0) {													$result =  $rentalManager->addRental($_POST['rent_idPlane'], $_POST['date'], $_POST['dTime'], $_POST['aTime'], $_POST['dAir'], $_POST['aAir'], $_POST['pilot']);							echo $result;													}else echo "<style type='text/css'> #addResp { color: red; }</style>Your don't have enough money on your account. Please do a check and send it to us at : <br/>The Golden Wings <br/> 15 Baker Street <br/> 15PR Pensylvania";					}				}else echo "<style type='text/css'> #addResp { color: red; }</style>Your did not paid your annual fees. Please do a check and send it to us at : <br/>The Golden Wings <br/> 15 Baker Street <br/> 15PR Pensylvania";			}else echo "<style type='text/css'> #addResp { color: red; }</style>Your departure time is after or equal to your arrival time!";		}else echo "<style type='text/css'> #addResp { color: red; }</style>The date you have chosen is past.";	}else echo "<style type='text/css'> #addResp { color: red; }</style>All fields have to be filled out.";}if(isset($_POST['idRental']) && isset($_POST['statusBis'])) {		if(!isset($rentalManager)) $rentalManager = ManagerFactory::getRentalManager();	$rentalManager->updateStatus($_POST['idRental'], $_POST['statusBis']);}				?>